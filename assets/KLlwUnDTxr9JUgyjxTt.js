import{o as d,c as u,a as e,d as z,E as U,G as q,j as x,e as _,u as h,t as y,b as D,g as P,f as T,p as C,v as A,m as j,F as B,H as ee,I as K,J as E,K as te,L as oe,q as se,r as le,y as ae,n as ne}from"./index-C0KEJt2O.js";import{L as ie,b as ce,c as re,d as de}from"./DadgABpvQcQp3i1OjiC.js";import{l as ue}from"./DZQLFrWwtX9iwzB4cFH.js";import{_ as ve,r as he,a as _e}from"./CLIttnAKTpoF3N2pgwE.js";import{u as fe,L as I}from"./DSDIviowczp1P7wQj8f.js";import{u as me,r as pe}from"./DICWlXTAeBBZEL3NSCJ.js";const ge={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-save",viewBox:"0 0 16 16"},be=e("path",{d:"M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1z"},null,-1),we=[be];function J(g,r){return d(),u("svg",ge,[...we])}const Le={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-x-square",viewBox:"0 0 16 16"},$e=e("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"},null,-1),ye=e("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"},null,-1),xe=[$e,ye];function ke(g,r){return d(),u("svg",Le,[...xe])}const je={class:"input-group"},Ce=["value"],Me=["title"],Ve=["title","disabled"],R=z({__name:"ltLocationInput",props:{modelValue:{required:!0},modelModifiers:{}},emits:U(["editLocation"],["update:modelValue"]),setup(g,{emit:r}){var n;const b=/(?<lat>[+-]?\d+\.?\d*)(_(?<ns>[NS]))?[_,;\s]+(?<lng>[+-]?\d+\.?\d*)(_(?<ew>[EW]))?/,p=q(g,"modelValue"),k=r,w=x((n=p.value)==null?void 0:n.type),L=x(null);function i(l){var f,m,$;if(l===void 0)return;if(!w.value){const F=(f=p.value)==null?void 0:f.type;F&&(w.value=F)}const t=l.match(b),s=!!t||!l;($=(m=L.value)==null?void 0:m.classList)==null||$.toggle("is-invalid",!s),s&&(p.value=new ie(w.value,t!=null&&t.groups?parseFloat(t.groups.lat)*(t.groups.ns==="S"?-1:1):void 0,t!=null&&t.groups?parseFloat(t.groups.lng)*(t.groups.ew==="W"?-1:1):void 0,p.value.lat,p.value.lng))}function a(){var l;p.value=(l=p.value)==null?void 0:l.rollback()}return(l,t)=>{var s;return d(),u("div",je,[e("input",{ref_key:"inputElement",ref:L,value:p.value.csv,class:"form-control",type:"text",onBlur:t[0]||(t[0]=f=>i(f.target.value)),onPaste:t[1]||(t[1]=f=>{var m;i((m=f.clipboardData)==null?void 0:m.getData("text")),f.preventDefault()})},null,40,Ce),e("button",{class:"btn btn-outline-secondary",type:"button",title:h(y)("Discard"),onClick:t[2]||(t[2]=f=>a())},[_(h(ke))],8,Me),e("button",{class:"btn btn-outline-success",type:"button",title:h(y)("Save"),disabled:!((s=p.value)!=null&&s.isChanged),onClick:t[3]||(t[3]=f=>k("editLocation"))},[_(h(J))],8,Ve)])}}}),Te={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-camera-fill",viewBox:"0 0 16 16"},Ae=e("path",{d:"M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"},null,-1),De=e("path",{d:"M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0"},null,-1),Se=[Ae,De];function W(g,r){return d(),u("svg",Te,[...Se])}const qe={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-exclamation-triangle-fill",viewBox:"0 0 16 16"},Fe=e("path",{d:"M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"},null,-1),He=[Fe];function X(g,r){return d(),u("svg",qe,[...He])}const ze={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-house-fill",viewBox:"0 0 16 16"},Oe=e("path",{d:"M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z"},null,-1),Be=e("path",{d:"m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"},null,-1),Ee=[Oe,Be];function Q(g,r){return d(),u("svg",ze,[...Ee])}const Ue={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-question-circle",viewBox:"0 0 16 16"},Ne=e("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"},null,-1),Pe=e("path",{d:"M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"},null,-1),Ie=[Ne,Pe];function G(g,r){return d(),u("svg",Ue,[...Ie])}const Re=["disabled"],Ge={class:"card mt-2"},Ke={class:"card-body p-2"},Je={class:"text-secondary me-1"},We={class:"text-secondary me-1"},Xe=["innerHTML"],Qe=["title"],Ye={class:"card mt-2"},Ze={class:"card-body p-2"},et={class:"text-secondary me-1"},tt={class:"text-secondary me-1"},ot=["innerHTML"],st=["title"],lt={key:0,class:"alert alert-danger mt-2"},at={class:"card mt-2"},nt={class:"card-header p-2"},it={key:0},ct=["href"],rt={class:"card-body p-2"},dt=z({__name:"ltFileDetails",props:U({file:{}},{coordinates:{required:!0},coordinatesModifiers:{},objectLocation:{required:!0},objectLocationModifiers:{}}),emits:["update:coordinates","update:objectLocation"],setup(g){const r=q(g,"coordinates"),b=q(g,"objectLocation"),p=g,k=x(void 0),w=x(!1),L=x(!1),i=D(()=>y(`Camera location via
<a href="https://commons.wikimedia.org/wiki/Template:Location" target="_blank"><code class="mediawiki-template">Location</code></a>`)),a=D(()=>y(`Object location via
<a href="https://commons.wikimedia.org/wiki/Template:Object_location" target="_blank"><code class="mediawiki-template">Object location</code></a>`)),n=D(()=>{var t;return y("Failed to save: {{$ctrl.error.statusText}}").replace("{{$ctrl.error.statusText}}",(t=k.value)==null?void 0:t.statusText)});function l(t){var s,f;return k.value=void 0,t===void 0&&(t=[],(s=r.value)!=null&&s.isChanged&&t.push(r.value),(f=b.value)!=null&&f.isChanged&&t.push(b.value)),ee(p.file,t).then(()=>{t.forEach(m=>{m.type==="Location"?r.value=m.commit():m.type==="Object location"&&(b.value=m.commit())})},m=>{k.value=m})}return(t,s)=>{var f,m;return d(),u(B,null,[e("button",{class:"btn btn-success form-control",type:"button",disabled:!((f=r.value)!=null&&f.isChanged||(m=b.value)!=null&&m.isChanged),onClick:s[0]||(s[0]=$=>l())},[_(h(J),{class:"me-1"}),P(" "+T(h(y)("Save")),1)],8,Re),e("div",Ge,[e("div",Ke,[e("div",null,[e("label",{onClick:s[1]||(s[1]=$=>w.value=!w.value)},[C(e("span",Je,"▼",512),[[A,!w.value]]),C(e("span",We,"▶",512),[[A,w.value]]),_(h(W),{class:"me-1"}),e("span",{innerHTML:i.value},null,8,Xe),C(e("abbr",{title:h(y)("Left click on map to set the location.")},[_(h(G))],8,Qe),[[A,!w.value]])]),C(e("div",null,[_(R,{modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=$=>r.value=$),onEditLocation:s[3]||(s[3]=$=>l([r.value]))},null,8,["modelValue"])],512),[[A,!w.value]])])])]),e("div",Ye,[e("div",Ze,[e("div",null,[e("label",{onClick:s[4]||(s[4]=$=>L.value=!L.value)},[C(e("span",et,"▼",512),[[A,!L.value]]),C(e("span",tt,"▶",512),[[A,L.value]]),_(h(Q),{class:"me-1"}),e("span",{innerHTML:a.value},null,8,ot),C(e("abbr",{title:h(y)("Press shift and click on map to set the object location.")},[_(h(G))],8,st),[[A,!L.value]])]),C(e("div",null,[_(R,{modelValue:b.value,"onUpdate:modelValue":s[5]||(s[5]=$=>b.value=$),onEditLocation:s[6]||(s[6]=$=>l([b.value]))},null,8,["modelValue"])],512),[[A,!L.value]])])])]),k.value?(d(),u("div",lt,[_(h(X),{class:"me-1"}),e("span",null,T(n.value),1)])):j("",!0),e("div",at,[e("h5",nt,[e("strong",null,T(t.file.file),1),P(" "+T(" ")+" "),t.file.url?(d(),u("small",it,[e("a",{href:t.file.url,target:"_blank"},[_(h(he))],8,ct)])):j("",!0)]),e("div",rt,[_(ve,{file:t.file},null,8,["file"])])])],64)}}}),ut=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16">
  <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z"/>
  <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
</svg>`,vt=z({__name:"ltMap",props:{coordinates:{required:!0},coordinatesModifiers:{},objectLocation:{required:!0},objectLocationModifiers:{}},emits:U(["mapViewChanged"],["update:coordinates","update:objectLocation"]),setup(g){const r=q(g,"coordinates"),b=q(g,"objectLocation"),p=x(null);K(()=>{const{map:a}=fe(p);a.on("click",n=>w(n)),E(r,k(a),{immediate:!0}),E(b,k(a),{immediate:!0})});function k(a){let n;return l=>{const{lat:t,lng:s}=l;if(l.isDefined&&n)a.setView({lat:t,lng:s}),n.setLatLng({lat:t,lng:s});else if(l.isDefined){a.setView({lat:t,lng:s});const f=I.divIcon({className:"b-0",html:`<div title="Object location" style="color: red">${ut}</div>`,iconAnchor:[6,6],iconSize:[12,12]});n=I.marker({lat:t,lng:s},l.type==="Location"?{draggable:!0}:{draggable:!0,icon:f}).on("moveend",m=>L(m,l)).addTo(a)}else n&&(n.remove(),n=void 0)}}function w(a){const{latlng:{lat:n,lng:l},originalEvent:{shiftKey:t}}=a;!n||!l||i(t?"Object location":"Location",n,l)}function L(a,n){const{lat:l,lng:t}=a.target.getLatLng();!l||!t||i(n.type,l,t)}function i(a,n,l){a==="Object location"?b.value=b.value.withLatLng(n,l).roundToPrecision():r.value=r.value.withLatLng(n,l).roundToPrecision()}return(a,n)=>(d(),u("div",{ref_key:"mapRef",ref:p,class:"map fill",style:{"min-height":"300px"}},null,512))}}),ht={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},_t=e("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"},null,-1),ft=[_t];function mt(g,r){return d(),u("svg",ht,[...ft])}const pt={key:0,class:"row mt-3"},gt={class:"col-sm-12"},bt={class:"jumbotron"},wt={key:1,class:"row mt-3"},Lt={class:"col-sm-12"},$t={class:"alert alert-warning"},yt=["innerHTML"],xt=["innerHTML"],kt={key:2,class:"row flex-grow-1 mt-3",style:{"--bs-gutter-x":"0.5rem"}},jt={class:"col-lg-3 col-xl-2 mt-3 mt-lg-0 fill col-lg-h40",style:{"overflow-y":"scroll","overflow-x":"hidden"}},Ct={class:"progress"},Mt={class:"form-group"},Vt={class:"checkbox"},Tt={class:"input-group"},At={class:"input-group-text"},Dt={class:"list-group"},St=["onClick"],qt={key:0,title:"Location ✔"},Ft={key:1,title:"Object location ✔"},Ht={key:0,class:"col-lg-9 col-xl-3 mt-3 mt-lg-0 fill col-lg-h40",style:{"overflow-y":"scroll","overflow-x":"hidden"}},zt={class:"row"},Ot={class:"col-lg-5 col-xl-12"},Bt={class:"col-lg-7 col-xl-12 mt-2"},Et={key:1,class:"col-lg-12 col-xl-7 mt-3 mt-lg-0 fill col-lg-h60"},Kt=z({__name:"ltGeolocate",setup(g){const r=ae(),b=r.query.category,p=r.query.user,k=x(),w=x(""),L=x(!1),i=x(void 0),a=x(void 0),n=x(!1);me(pe(),y("Geolocate files")),K(()=>{const o=ce(r.query),c=o.then(M=>re(M)).then(M=>{a.value=M.sort((S,V)=>S.file.localeCompare(V.file)),L.value=a.value.length<=5,i.value=t.value[0]});n.value=!0,Promise.all([o,c]).finally(()=>n.value=!1)}),E(i,o=>o&&$(o));function l(o){return o.coordinates.isDefinedAndSaved||o.objectLocation.isDefinedAndSaved}const t=D(()=>{let o=a.value||[];return o=L.value?o:o.filter(c=>!l(c)),o=o.filter(c=>JSON.stringify(c).includes(w.value)),o}),s=D(()=>a.value?a.value.filter(o=>l(o)):[]),f=D(()=>100*s.value.length/(a.value||[]).length);function m(o){const c=t.value,M=F(o);if(M===void 0||i.value===void 0)return;const S=c.indexOf(i.value),V=M+S;if(V>=0&&c[V]){i.value=c[V];const v=o.target;window.requestAnimationFrame(()=>{var O,H,N;return(N=(H=(O=v.querySelectorAll(".list-group-item"))==null?void 0:O[V])==null?void 0:H.scrollIntoView)==null?void 0:N.call(H,{block:"center"})})}}function $(o){k.value=void 0,o!=null&&o.pageid&&de(o.pageid).then(c=>{Object.assign(o,c)})}function F(o){if(o&&o.key)switch(o.key){case"Right":case"ArrowRight":case"Down":case"ArrowDown":return o.preventDefault(),1;case"Left":case"ArrowLeft":case"Up":case"ArrowUp":return o.preventDefault(),-1}}const Y=D(()=>y("Fetched 0 files for category <code>{{$ctrl.category}}</code>!").replace("{{$ctrl.category}}",b)),Z=D(()=>y("Fetched 0 files for user <code>{{$ctrl.user}}</code>!").replace("{{$ctrl.user}}",p));return(o,c)=>{var M,S,V;return d(),u(B,null,[n.value?(d(),u("div",pt,[e("div",gt,[e("div",bt,[e("p",null,T(h(y)("Loading file details …")),1),_(ue)])])])):j("",!0),!n.value&&!((M=a.value)!=null&&M.length)?(d(),u("div",wt,[e("div",Lt,[e("div",$t,[_(h(X),{class:"me-1"}),h(b)?(d(),u("span",{key:0,innerHTML:Y.value},null,8,yt)):j("",!0),h(p)?(d(),u("span",{key:1,innerHTML:Z.value},null,8,xt)):j("",!0)])])])):j("",!0),!n.value&&((S=a.value)!=null&&S.length)?(d(),u("div",kt,[e("div",jt,[e("div",Ct,[e("div",{class:"progress-bar",role:"progressbar",style:te({width:f.value+"%"})},T(s.value.length)+" / "+T((V=a.value)==null?void 0:V.length),5)]),e("div",Mt,[e("div",Vt,[e("label",null,[C(e("input",{"onUpdate:modelValue":c[0]||(c[0]=v=>L.value=v),type:"checkbox"},null,512),[[oe,L.value]]),e("span",null,T(h(y)("Also show geolocated files")),1)])])]),e("div",Tt,[e("div",At,[_(h(mt))]),C(e("input",{"onUpdate:modelValue":c[1]||(c[1]=v=>w.value=v),class:"form-control",type:"text"},null,512),[[se,w.value]])]),e("div",{tabindex:"1",onKeydown:c[2]||(c[2]=v=>m(v))},[e("ul",Dt,[(d(!0),u(B,null,le(t.value,v=>(d(),u("li",{key:v.file,class:ne(["list-group-item py-1 px-2 text-truncate",{"list-group-item-info":i.value===v}]),role:"button",onClick:O=>i.value=v},[v.coordinates.isDefinedAndSaved?(d(),u("abbr",qt,[_(h(W),{class:"me-1"})])):j("",!0),v.objectLocation.isDefinedAndSaved?(d(),u("abbr",Ft,[_(h(Q),{class:"me-1"})])):j("",!0),e("span",null,T(v.file),1)],10,St))),128))])],32)]),i.value?(d(),u("div",Ht,[e("div",zt,[e("div",Ot,[_(dt,{coordinates:i.value.coordinates,"onUpdate:coordinates":c[3]||(c[3]=v=>i.value.coordinates=v),"object-location":i.value.objectLocation,"onUpdate:objectLocation":c[4]||(c[4]=v=>i.value.objectLocation=v),file:i.value},null,8,["coordinates","object-location","file"])]),e("div",Bt,[_(_e,{file:i.value},null,8,["file"])])])])):j("",!0),i.value?(d(),u("div",Et,[_(vt,{coordinates:i.value.coordinates,"onUpdate:coordinates":c[5]||(c[5]=v=>i.value.coordinates=v),"object-location":i.value.objectLocation,"onUpdate:objectLocation":c[6]||(c[6]=v=>i.value.objectLocation=v)},null,8,["coordinates","object-location"])])):j("",!0)])):j("",!0)],64)}}});export{Kt as default};
//# sourceMappingURL=KLlwUnDTxr9JUgyjxTt.js.map
